DROP TABLE BOOK;

DROP TABLE AUTHOR;
DROP TABLE PUBLISHER;

SET SERVEROUTPUT ON;

create table author(author_id number(4) primary key,
name varchar(20),
birth_date date,
country varchar(20));

create table publisher(publisher_id number(4) primary key,
name varchar(20) unique,
counntry varchar(20) default('India'));

create table book( title varchar(20),
publisher_id number(2),
author_id number(4),
price number(3),
foreign key (publisher_id)references publisher(publisher_id),
foreign key (author_id)references author(author_id),
primary key(title,publisher_id));

INSERT INTO AUTHOR VALUES(1000,'NANDA','23-JUN-1981','INDIA');
INSERT INTO AUTHOR VALUES(2000,'GOPAL','15-AUG-1947','USA');
INSERT INTO AUTHOR VALUES(3000,'BALA','26-JAN-1994','USA');
INSERT INTO AUTHOR VALUES(4000,'GURU','5-DEC-1994','INDIA');
INSERT INTO AUTHOR VALUES(5000,'SWAMY','24-FEB-1989','INDIA');

INSERT INTO PUBLISHER VALUES(10,'Sapna','INDIA');
INSERT INTO PUBLISHER VALUES(20,'Tata','USA');
INSERT INTO PUBLISHER VALUES(30,'MACMILAN','UK');
INSERT INTO PUBLISHER VALUES(40,'VT','USA');
INSERT INTO PUBLISHER VALUES(50,'Intel','USA');

INSERT INTO BOOK VALUES('JAVA',10,1000,100);
INSERT INTO BOOK VALUES('C++',40,2000,200);
INSERT INTO BOOK VALUES('RDBMS',30,2000,250);
INSERT INTO BOOK VALUES('JAVA',30,3000,100);
INSERT INTO BOOK VALUES('RDBMS',10,4000,250);
INSERT INTO BOOK VALUES('C',40,4000,200);
INSERT INTO BOOK VALUES('ANDROID',50,5000,150);

SELECT BOOK.TITLE FROM AUTHOR,BOOK WHERE AUTHOR.AUTHOR_ID=BOOK.AUTHOR_ID AND AUTHOR.COUNTRY='INDIA';

SELECT BOOK.TITLE FROM AUTHOR,BOOK WHERE AUTHOR.AUTHOR_ID=BOOK.AUTHOR_ID AND AUTHOR.BIRTH_DATE<='01-JAN-1994';

WITH TTABLE( AUTHOR_ID, NOB) AS (SELECT AUTHOR_ID,COUNT(AUTHOR_ID) FROM BOOK GROUP BY(AUTHOR_ID))
SELECT AUTHOR.NAME FROM AUTHOR ,TTABLE WHERE AUTHOR.AUTHOR_ID=TTABLE.AUTHOR_ID AND NOB >=(SELECT MAX(NOB) FROM TTABLE WHERE AUTHOR.AUTHOR_ID=TTABLE.AUTHOR_ID);

CREATE TABLE PUBLISHER_AUDIT(PUBLISHER_NAME varchar(20),
COUNTRY_NAME varchar(20),
COUNTRY_COUNT NUMBER(1));


CREATE OR REPLACE PROCEDURE P1 is
CURSOR C1 IS SELECT * FROM PUBLISHER FOR UPDATE;
BEGIN
	FOR X IN C1 LOOP
		IF (ISUPPER(X.NAME)) THEN;
			UPDATE PUBLISHER SET NAME=NAME WHERE CURRENT OF;
		END IF;
	END LOOP;
END;
/

CREATE OR REPLACE TRIGGER TRIG1 
BEFORE UPDATE ON PUBLISHER 
FOR EACH ROW
BEGIN 
	CASE
	WHEN UPDATING THEN
	INSERT INTO PUBLISHER_AUDIT(PUBLISHER_NAME,COUNTRY_NAME) VALUES(:OLD.NAME,:OLD.COUNTRY);
	END CASE;
END;
/
		
DECLARE
BEGIN
	 P1;
END;
/	
	
	